# 服务器核心配置
server:
  port: 8080 # Web服务端口
  servlet:
    context-path: / # 项目根路径
    encoding:
      charset: UTF-8 # 全局字符编码，避免中文乱码
      enabled: true
      force: true
  tomcat:
    uri-encoding: UTF-8 # Tomcat容器编码

# Spring核心配置
spring:
  main:
    allow-circular-references: true # 允许循环依赖
  # 1. Jackson配置（适配DTO自动转JSON返回前端）
  jackson:
    time-zone: Asia/Shanghai # 时区统一
    date-format: yyyy-MM-dd HH:mm:ss # 时间格式
    default-property-inclusion: non_null # 忽略null字段，前端展示更简洁
    serialization:
      fail-on-empty-beans: false # 允许空DTO序列化（避免算法结果空对象报错）
      write-date-timestamps-as-nanoseconds: false # 时间戳兼容前端

  # 2. 跨域配置（SpringBoot 2.7.x 正确写法，原配置不生效）
  web:
    cors:
      allowed-origins: "http://localhost:8081,http://127.0.0.1:8081" # 开发环境前端地址
      allowed-methods: GET,POST,PUT,DELETE,OPTIONS # 允许的请求方法
      allowed-headers: "*" # 允许所有请求头
      allow-credentials: true # 允许携带Cookie（如需）
      max-age: 3600 # 预检请求缓存1小时，减少请求次数

  # 3. MySQL数据库配置（核心，适配8.0.33版本）
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver # MySQL 8.x驱动
    url: jdbc:mysql://localhost:3306/coursedesign?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai&useSSL=false&allowPublicKeyRetrieval=true&rewriteBatchedStatements=true
    username: root # 替换为你的MySQL用户名
    password: 123456 # 替换为你的MySQL密码
    # HikariCP连接池配置（适配多线程算法执行）
    hikari:
      minimum-idle: 5 # 最小空闲连接
      maximum-pool-size: 20 # 最大连接数
      auto-commit: true
      idle-timeout: 30000 # 空闲连接超时
      pool-name: PageReplacementHikariCP
      max-lifetime: 1800000 # 连接最大生命周期
      connection-timeout: 30000 # 连接超时

# 4. MyBatis-Plus配置（核心：让Json2StringTypeHandler生效）
mybatis-plus:
  mapper-locations: classpath:mapper/**/*.xml # Mapper.xml文件路径
  type-aliases-package: ys.rg.fourClass.entity # 你的实体类包路径（关键修正）
  type-handlers-package: ys.rg.fourClass.handler # 扫描自定义JSON Handler（关键）
  # 配置扫描包（重要）
  mapper-scan:
    base-package: ys.rg.fourClass.mapper
  global-config:
    db-config:
      id-type: AUTO # 主键自增
      logic-delete-field: isDeleted # 匹配你的实体逻辑删除字段（isDeleted/isDelete）
      logic-delete-value: 1 # 已删除标记
      logic-not-delete-value: 0 # 未删除标记
  configuration:
    map-underscore-to-camel-case: true # 下划线转驼峰（适配数据库字段）
    cache-enabled: false # 关闭二级缓存
    call-setters-on-nulls: true # 查询返回null字段（前端不缺失）
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl # 打印SQL（开发调试）

# ============================================
# 日志配置
# ============================================
logging:
  # 1. 日志级别配置
  level:
    ys.rg.fourClass: DEBUG # 你的业务包日志级别
    com.baomidou.mybatisplus: DEBUG # MyBatis-Plus日志级别
    java.sql: INFO # 数据库SQL日志级别
    org.springframework: INFO # Spring框架日志级别

  # 2. 控制台日志格式
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{50} - %msg%n"

  # 3. 文件日志配置
  file:
    name: logs/page-replacement.log # 日志文件路径
    max-history: 30 # 保留30天的日志
    max-size: 10MB # 单个日志文件最大10MB

  # 4. 日志文件滚动策略
  logback:
    rollingpolicy:
      max-file-size: 10MB
      total-size-cap: 100MB
